<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Darkflames Blog]]></title><description><![CDATA[Developer / 业余摄影 / 胶片爱好者]]></description><link>https://dark-flames.com</link><image><url>https://dark-flames.com/logos/logo-512.png</url><title>Darkflames Blog</title><link>https://dark-flames.com</link></image><generator>GatsbyJS Casper Starter</generator><lastBuildDate>Wed, 30 Dec 2020 15:29:58 GMT</lastBuildDate><atom:link href="https://dark-flames.com/rss.xml" rel="self" type="application/rss+xml"/><author><![CDATA[Darkflames]]></author><copyright><![CDATA[Darkflames Blog © 2020]]></copyright><item><title><![CDATA[Yui 项目简介]]></title><description><![CDATA[Yui 是笔者使用编写的第一个项目，本来是准备写一个ORM，但是在处理attribute的过程中写了很多重复的代码，所以决定将这一部分单独抽象成一个lib。 核心功能 Yui 的核心功能是根据 AttributeStructure 定义的 attribute pattern…]]></description><link>https://dark-flames.com/yui-introduction</link><guid isPermaLink="false">https://dark-flames.com/yui-introduction</guid><category><![CDATA[编程]]></category><category><![CDATA[Rust]]></category><category><![CDATA[Yui]]></category><dc:creator><![CDATA[Darkflames]]></dc:creator><pubDate>Mon, 08 Jun 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://github.com/dark-flames/Yui&quot;&gt;Yui&lt;/a&gt; 是笔者使用&lt;code class=&quot;language-text&quot;&gt;Rust&lt;/code&gt;编写的第一个项目，本来是准备写一个ORM，但是在处理attribute的过程中写了很多重复的代码，所以决定将这一部分单独抽象成一个lib。&lt;/p&gt;
&lt;h3 id=&quot;核心功能&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD&quot; aria-label=&quot;核心功能 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;核心功能&lt;/h3&gt;
&lt;p&gt;Yui 的核心功能是根据 AttributeStructure 定义的 attribute pattern 匹配 &lt;code class=&quot;language-text&quot;&gt;syn&lt;/code&gt;中的 attribute 结构&lt;/p&gt;
&lt;h4 id=&quot;定义attributestructure&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%AE%9A%E4%B9%89attributestructure&quot; aria-label=&quot;定义attributestructure permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;定义AttributeStructure&lt;/h4&gt;
&lt;p&gt;Yui 可以使用 Rust 中的&lt;code class=&quot;language-text&quot;&gt;struct&lt;/code&gt;定义 AttributeStructure，匹配过程中将会依照 AttributeStructure 作为 pattern 进行处理。同时，&lt;code class=&quot;language-text&quot;&gt;Struct Struct&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;Tuple Struct&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;NoField Struct&lt;/code&gt;均可以用于定义 AttributeStructure。&lt;/p&gt;
&lt;p&gt;Yui 提供了名为&lt;code class=&quot;language-text&quot;&gt;yui::YuiAttribute&lt;/code&gt;的 derive 宏，会为 AttributeStructure 生成 &lt;code class=&quot;language-text&quot;&gt;yui::AttributeStructure&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;quote::ToTokens&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;syn::parse_macro_input::ParseMacroInput&lt;/code&gt;的相关实现。所有使用了这个宏的 struct 均可以作为 AttributeStructure 使用。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; yui&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;YuiAttribute&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token attribute attr-name&quot;&gt;#[derive(YuiAttribute)]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; NoField&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token attribute attr-name&quot;&gt;#[derive(YuiAttribute)]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Tuple&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i32&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token attribute attr-name&quot;&gt;#[derive(YuiAttribute)]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; Struct &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    int&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; i32&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    float&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; f64&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    bool&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; bool&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;attributefield的类型&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#attributefield%E7%9A%84%E7%B1%BB%E5%9E%8B&quot; aria-label=&quot;attributefield的类型 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;AttributeField的类型&lt;/h4&gt;
&lt;p&gt;AttributeStructure 的每一个 field 均对应了所匹配 attribute 中的一个字段。可以使用如下类型：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;String: Rust 中的 &lt;code class=&quot;language-text&quot;&gt;String&lt;/code&gt;类型。&lt;/li&gt;
&lt;li&gt;Bool: Rust 中的 &lt;code class=&quot;language-text&quot;&gt;bool&lt;/code&gt;类型。&lt;/li&gt;
&lt;li&gt;Integer: Rust 中任意整数类型如&lt;code class=&quot;language-text&quot;&gt;i32&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;u32&lt;/code&gt;等。&lt;/li&gt;
&lt;li&gt;Float: Rust 中任意浮点类型如 &lt;code class=&quot;language-text&quot;&gt;f32&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;f64&lt;/code&gt;等。&lt;/li&gt;
&lt;li&gt;Enum: 已经定义的 EnumValue，详见 &lt;a href=&quot;#enumvalue&quot;&gt;EnumValue&lt;/a&gt;。&lt;/li&gt;
&lt;li&gt;Object: 其他已经定义的 AttributeStructure。&lt;/li&gt;
&lt;li&gt;Vec&amp;#x3C;T&gt;: 包含 T 类型的 Vec（T不可为 Object、Vec 或者 HashMap）。&lt;/li&gt;
&lt;li&gt;HashMap&amp;#x3C;String, T&gt;: 以 String 作为键的T类型HashMap。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果想要将一个字段设为可选字段，只需要将其对应 field 的类型标记为&lt;code class=&quot;language-text&quot;&gt;Option&amp;lt;T&amp;gt;&lt;/code&gt;即可。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; yui&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;YuiEnumValue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; YuiAttribute&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token attribute attr-name&quot;&gt;#[derive(YuiAttribute)]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; Bar&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token attribute attr-name&quot;&gt;#[derive(YuiEnumValue)]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;enum&lt;/span&gt; SomeEnum &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    A&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    B
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token attribute attr-name&quot;&gt;#[derive(YuiAttribute)]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; Foo &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    string&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    bool&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; bool&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    int&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; i32&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    float&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; f32&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    object&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Bar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token attribute attr-name&quot;&gt;#[attribute_field(enum_value=true)]&lt;/span&gt;
    enum_field&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; SomeEnum&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    list&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Vec&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;i32&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    map&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; std&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;collections&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;HashMap&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; SomeEnum&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    optional&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Option&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;i32&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 可选字段&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;enumvalue&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#enumvalue&quot; aria-label=&quot;enumvalue permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;EnumValue&lt;/h4&gt;
&lt;p&gt;在 &lt;code class=&quot;language-text&quot;&gt;enum&lt;/code&gt; 上使用&lt;code class=&quot;language-text&quot;&gt;yui::YuiEnumValue&lt;/code&gt;后，可以将其作为 EnumValue 使用。在解析 attribute 时，会将字段的字符串值自动转换为字符串对应的 variant。&lt;/p&gt;
&lt;p&gt;同时，也可以在每一个 variant 上使用&lt;code class=&quot;language-text&quot;&gt;variant_value&lt;/code&gt; attribute 来定义它所对应的字符串值。对于未定义的 variant，Yui 将会使用它的标识符（转换为 &lt;code class=&quot;language-text&quot;&gt;snake_case&lt;/code&gt;）作为它对应的字符串值。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; yui&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;YuiEnumValue&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token attribute attr-name&quot;&gt;#[derive(YuiEnumValue)]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;enum&lt;/span&gt; SomeEnum &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token attribute attr-name&quot;&gt;#[variant_value(&quot;aaa&quot;)]&lt;/span&gt;
    A&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 对应的字符串为&quot;aaa&quot;&lt;/span&gt;
    B  &lt;span class=&quot;token comment&quot;&gt;// 对应的字符串为&quot;b&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意，将 field 设为&lt;code class=&quot;language-text&quot;&gt;Enum&lt;/code&gt;类型时，需要为其添加&lt;code class=&quot;language-text&quot;&gt;enum_value=true&lt;/code&gt;的选项，以与&lt;code class=&quot;language-text&quot;&gt;Object&lt;/code&gt;类型区别，详见&lt;a href=&quot;#%E9%80%89%E9%A1%B9&quot;&gt;选项&lt;/a&gt;。
除此之外，&lt;code class=&quot;language-text&quot;&gt;variant_value&lt;/code&gt;暂时仅支持字符串值。&lt;/p&gt;
&lt;h4 id=&quot;选项&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E9%80%89%E9%A1%B9&quot; aria-label=&quot;选项 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;选项&lt;/h4&gt;
&lt;p&gt;在 field 上使用&lt;code class=&quot;language-text&quot;&gt;attribute_field&lt;/code&gt;可以设置相关选项：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;alias&lt;br&gt;
重新设置 field 对应的字段名，默认为 field 的标识符(转换为&lt;code class=&quot;language-text&quot;&gt;snake_case&lt;/code&gt;)。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token attribute attr-name&quot;&gt;#[derive(YuiAttribute)]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; Foo &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token attribute attr-name&quot;&gt;#[attribute_field(alias = &quot;i32&quot;)]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;pub&lt;/span&gt; int32&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; i32&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;default&lt;br&gt;
默认值，如果 attribute 中这个字段未给出，则将其设置为默认值。对于可选的字段，将会以&lt;code class=&quot;language-text&quot;&gt;Some(default_value)&lt;/code&gt;的形式给出。如果一个非可选字段在 attribute 中未被赋值并且没有设置默认值，处理过程中将会报错。&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;Object&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;Vec&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;HashMap&lt;/code&gt;类型无法设置默认值，对于&lt;code class=&quot;language-text&quot;&gt;Enum&lt;/code&gt;类型的字段，请将默认值设置为 variant 对应的字符串值。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token attribute attr-name&quot;&gt;#[derive(YuiAttribute)]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; Foo &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token attribute attr-name&quot;&gt;#[attribute_field(default = 1024)]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;pub&lt;/span&gt; int32&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; i32&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token attribute attr-name&quot;&gt;#[attribute_field(default = &quot;string&quot;)]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;pub&lt;/span&gt; string&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token attribute attr-name&quot;&gt;#[attribute_field(default = &quot;aaa&quot;, enum_value=true]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;pub&lt;/span&gt; enum_value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; SomeEnum
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;enum_value&lt;br&gt;
用于区别&lt;code class=&quot;language-text&quot;&gt;Enum&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;Object&lt;/code&gt;类型。如果这个字段为&lt;code class=&quot;language-text&quot;&gt;Enum&lt;/code&gt;类型，请将这个字段设置为&lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;关于code-classlanguage-textobjectcode类型&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E5%85%B3%E4%BA%8Ecode-classlanguage-textobjectcode%E7%B1%BB%E5%9E%8B&quot; aria-label=&quot;关于code classlanguage textobjectcode类型 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;关于&lt;code class=&quot;language-text&quot;&gt;Object&lt;/code&gt;类型&lt;/h4&gt;
&lt;p&gt;由于 Rust attribute 语法所限。当一个字段类型为&lt;code class=&quot;language-text&quot;&gt;Object&lt;/code&gt;时，其所对应的 AttributeStructure 的标识符将会失去作用。具体匹配的 attribute 请参照如下例子。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; yui&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;YuiAttribute&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 这一 AttributeStruture 匹配的 attribute 为 #[Fool(test=114514)]&lt;/span&gt;
&lt;span class=&quot;token attribute attr-name&quot;&gt;#[derive(YuiAttribute)]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; Foo &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    test&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; i32
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// 这一 AttributeStruture 匹配的 attribute 为 #[Bar(fool_field(test=114514))]&lt;/span&gt;
&lt;span class=&quot;token attribute attr-name&quot;&gt;#[derive(YuiAttribute)]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; Bar &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    foo_field&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Fool&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;使用code-classlanguage-textsyncode-读取-attribute&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8code-classlanguage-textsyncode-%E8%AF%BB%E5%8F%96-attribute&quot; aria-label=&quot;使用code classlanguage textsyncode 读取 attribute permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用&lt;code class=&quot;language-text&quot;&gt;syn&lt;/code&gt; 读取 attribute&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;使用&lt;code class=&quot;language-text&quot;&gt;syn&lt;/code&gt;解析&lt;code class=&quot;language-text&quot;&gt;TokenStream&lt;/code&gt;&lt;br&gt;
如果你只需要读取最外层结构（&lt;code class=&quot;language-text&quot;&gt;struct&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;enum&lt;/code&gt;或&lt;code class=&quot;language-text&quot;&gt;tuple&lt;/code&gt;）上的 attribute, 可以直接使用 &lt;code class=&quot;language-text&quot;&gt;syn::parse_macro_input!&lt;/code&gt;。
同时，Yui 提供了&lt;code class=&quot;language-text&quot;&gt;yui::AttributeStructures&lt;/code&gt;用来包裹多个 AttributeStructure。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; attributes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; syn&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;parse_macro_inpit!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;input &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; yui&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;AttributeStructs&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Foo&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;从&lt;code class=&quot;language-text&quot;&gt;syn::Meta&lt;/code&gt;创建 AttributeStructure&lt;br&gt;
如果你想解析其他位置的 attribute，请获取其对应的&lt;code class=&quot;language-text&quot;&gt;syn::Meta&lt;/code&gt;对象后使用&lt;code class=&quot;language-text&quot;&gt;yui::AttributeStructure::from_meta()&lt;/code&gt;方法。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; meta &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; attr&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;parse_meta&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; attributes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Foo&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from_meta&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;meta&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;从&lt;code class=&quot;language-text&quot;&gt;syn::AttributeArgs&lt;/code&gt;创建 AttributeStructure&lt;br&gt;
如果你已经获取了 attribute 对应的&lt;code class=&quot;language-text&quot;&gt;syn::AttributeArgs&lt;/code&gt;对象，可以使用&lt;code class=&quot;language-text&quot;&gt;yui::AttributeStructure::from_attribute_args()&lt;/code&gt;方法获取 AttributeStructure。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; attributes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Foo&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from_attribute_args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;attribute_args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;使用code-classlanguage-textquotecode符号化-attributestructure&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8code-classlanguage-textquotecode%E7%AC%A6%E5%8F%B7%E5%8C%96-attributestructure&quot; aria-label=&quot;使用code classlanguage textquotecode符号化 attributestructure permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用&lt;code class=&quot;language-text&quot;&gt;quote&lt;/code&gt;符号化 AttributeStructure&lt;/h4&gt;
&lt;p&gt;AttributeStructure 被自动实现了 &lt;code class=&quot;language-text&quot;&gt;quote::ToTokens&lt;/code&gt;，可以直接使用&lt;code class=&quot;language-text&quot;&gt;quote::quote!&lt;/code&gt;将其符号化。&lt;/p&gt;
&lt;p&gt;注意，如果要使用此功能，需要将 AttributeStructure 的所有 field 设置为&lt;code class=&quot;language-text&quot;&gt;pub&lt;/code&gt;，并且为其添加&lt;code class=&quot;language-text&quot;&gt;Clone&lt;/code&gt; derive 宏。&lt;/p&gt;
&lt;p&gt;由于输出的 TokenStream 是 AttributeStructure 的构造表达式，所以无法将其赋值给&lt;code class=&quot;language-text&quot;&gt;static&lt;/code&gt;或者&lt;code class=&quot;language-text&quot;&gt;const&lt;/code&gt;，请使用&lt;code class=&quot;language-text&quot;&gt;lazy_static&lt;/code&gt;或者将其作为函数的返回值。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; attributes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Foo&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from_meta&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;meta&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

quote&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token macro-rules function&quot;&gt;quote!&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;get_attrs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;-&gt;&lt;/span&gt; Foo &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        #attributes
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;扩展功能：reader-generator&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E6%89%A9%E5%B1%95%E5%8A%9F%E8%83%BD%EF%BC%9Areader-generator&quot; aria-label=&quot;扩展功能：reader generator permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;扩展功能：Reader Generator&lt;/h3&gt;
&lt;p&gt;提供了用于生成默认 Reader 的过程宏 &lt;code class=&quot;language-text&quot;&gt;yui::generate_reader!&lt;/code&gt;。同时提供了运行时读取attribute的工具宏&lt;code class=&quot;language-text&quot;&gt;yui::get_attribute!&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;yui::has_attribute!&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;如果要使用此功能，请打开&lt;code class=&quot;language-text&quot;&gt;generate-reader&lt;/code&gt; feature。&lt;/p&gt;
&lt;h5 id=&quot;生成-derive-宏&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E7%94%9F%E6%88%90-derive-%E5%AE%8F&quot; aria-label=&quot;生成 derive 宏 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;生成 Derive 宏&lt;/h5&gt;
&lt;p&gt;如果想要使用&lt;code class=&quot;language-text&quot;&gt;yui::get_attribute&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;yui::has_attribute&lt;/code&gt;。首先需要使用&lt;code class=&quot;language-text&quot;&gt;yui::generate_reader!&lt;/code&gt;生成一个 derive 宏，任何使用了这个宏的对象均可以使用&lt;code class=&quot;language-text&quot;&gt;yui::get_attribute&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;yui::has_attribute&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;yui&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;generate_reader!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;DeriveName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;StructAttr&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;FieldAttr&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;第一个参数为 Derive 的标识符。第二个参数为读取结构上 AttributeStructure 的列表，第三个可选参数为读取 Field 上 AttributeStructure 的列表。
请在这一文件中&lt;code class=&quot;language-text&quot;&gt;use&lt;/code&gt;所需要的所有 AttributeStructure。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;yui::generate_reader!&lt;/code&gt;将会生成一个&lt;code class=&quot;language-text&quot;&gt;pub&lt;/code&gt;的 derive 宏，所以请为你的 lib 打开&lt;code class=&quot;language-text&quot;&gt;proc_macro&lt;/code&gt;。&lt;/p&gt;
&lt;h4 id=&quot;读取-attribute&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#%E8%AF%BB%E5%8F%96-attribute&quot; aria-label=&quot;读取 attribute permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;读取 attribute&lt;/h4&gt;
&lt;p&gt;将&lt;code class=&quot;language-text&quot;&gt;yui::generate_reader!&lt;/code&gt;生成的 derive 宏作用在任意&lt;code class=&quot;language-text&quot;&gt;struct&lt;/code&gt;、&lt;code class=&quot;language-text&quot;&gt;enum&lt;/code&gt; 或&lt;code class=&quot;language-text&quot;&gt;union&lt;/code&gt; 上，即可对其使用&lt;code class=&quot;language-text&quot;&gt;yui::get_attribute&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;yui::has_attribute&lt;/code&gt;。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; yui&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;get_attribute&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; has_attribute&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token attribute attr-name&quot;&gt;#[derive(MyDerive)]&lt;/span&gt;
&lt;span class=&quot;token attribute attr-name&quot;&gt;#[StructAttr(&quot;some parameters&quot;)]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; Foo &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token attribute attr-name&quot;&gt;#[FieldAttr(&quot;some parameters&quot;)]&lt;/span&gt;
    field&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; i32
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;some_fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;assert!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;has_attribute!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; StructAttr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;assert!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;has_attribute!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Foo&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; FieldAttr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; struct_attr1&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Option&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;StructAttribute1&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;get_attribute!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Foo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; StructAttr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; field_attr1&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Option&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;StructAttribute1&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;get_attribute!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Foo&lt;span class=&quot;token punctuation&quot;&gt;::&lt;/span&gt;field&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; StructAttr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其中&lt;code class=&quot;language-text&quot;&gt;yui::has_attribute!&lt;/code&gt;返回&lt;code class=&quot;language-text&quot;&gt;bool&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;yui::get_attribute!(_, T)&lt;/code&gt;返回&lt;code class=&quot;language-text&quot;&gt;Option&amp;lt;T&amp;gt;&lt;/code&gt;。&lt;/p&gt;</content:encoded></item></channel></rss>